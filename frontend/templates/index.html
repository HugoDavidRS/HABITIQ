{% extends "base.html" %}

{% block title %}Mis Hábitos - HabitIQ{% endblock %}

{% block content %}
<div class="page-header">
    <h1><i class="fas fa-list-check"></i> Mis Hábitos</h1>
    <p>Gestiona todos tus hábitos en un solo lugar</p>
</div>

<div class="actions-bar">
    <a href="{{ url_for('create_habit') }}" class="btn btn-primary">
        <i class="fas fa-plus"></i> Crear Nuevo Hábito
    </a>
    <div class="stats-summary">
        <span class="stat-item">
            <i class="fas fa-fire"></i>
            <strong>{{ habits|length }}</strong> hábitos totales
        </span>
        <span class="stat-item">
            <i class="fas fa-check-circle"></i>
            <strong>{{ habits|selectattr('is_active')|list|length }}</strong> activos
        </span>
    </div>
</div>

{% if habits %}
    <div class="habits-grid">
        {% for habit in habits %}
            <div class="habit-card {% if not habit.is_active %}inactive{% endif %}">
                <div class="habit-header">
                    <h3>{{ habit.name }}</h3>
                    <div class="habit-actions">
                        <a href="{{ url_for('edit_habit', habit_id=habit.id) }}" 
                           class="btn-icon" title="Editar">
                            <i class="fas fa-edit"></i>
                        </a>
                        <form action="{{ url_for('delete_habit', habit_id=habit.id) }}" 
                              method="POST" class="delete-form"
                              onsubmit="return confirm('¿Estás seguro de eliminar este hábito?');">
                            <button type="submit" class="btn-icon btn-delete" title="Eliminar">
                                <i class="fas fa-trash"></i>
                            </button>
                        </form>
                    </div>
                </div>
                
                {% if habit.description %}
                    <p class="habit-description">{{ habit.description }}</p>
                {% endif %}
                
                <div class="habit-meta">
                    <span class="category-badge category-{{ habit.category }}">
                        <i class="fas fa-{{ 'heartbeat' if habit.category == 'health' else 'running' if habit.category == 'fitness' else 'book' if habit.category == 'learning' else 'briefcase' if habit.category == 'productivity' else 'brain' }}">
                        </i> {{ habit.category|capitalize }}
                    </span>
                    <span class="frequency">
                        <i class="fas fa-calendar"></i> {{ habit.frequency|capitalize }}
                    </span>
                </div>
                
                <div class="habit-stats">
                    <div class="stat">
                        <small>Racha Actual</small>
                        <div class="streak">
                            <i class="fas fa-fire"></i> {{ habit.current_streak }} días
                        </div>
                    </div>
                    <div class="stat">
                        <small>Mejor Racha</small>
                        <div class="best-streak">
                            <i class="fas fa-trophy"></i> {{ habit.best_streak }} días
                        </div>
                    </div>
                </div>
                
                <div class="habit-footer">
                    <form action="{{ url_for('toggle_complete', habit_id=habit.id) }}" 
                          method="POST" class="complete-form">
                        <button type="submit" class="btn {% if is_completed_today(habit.id) %}btn-completed{% else %}btn-outline{% endif %}">
                            {% if is_completed_today(habit.id) %}
                                <i class="fas fa-check-circle"></i> Completado
                            {% else %}
                                <i class="far fa-circle"></i> Marcar como hecho
                            {% endif %}
                        </button>
                    </form>
                    
                    <div class="habit-state">
                        <form action="{{ url_for('toggle_habit', habit_id=habit.id) }}" method="POST" style="display: inline;">
                            <button type="submit" class="btn-status {% if habit.is_active %}btn-active{% else %}btn-inactive{% endif %}">
                                <i class="fas fa-{{ 'play' if not habit.is_active else 'pause' }}"></i>
                                {{ 'Activar' if not habit.is_active else 'Pausar' }}
                            </button>
                        </form>
                    </div>
                    
                    <span class="habit-date">
                        Creado: {{ habit.created_at.strftime('%d/%m/%Y') }}
                    </span>
                </div>
            </div>
        {% endfor %}
    </div>
{% else %}
    <div class="empty-state">
        <div class="empty-icon">
            <i class="fas fa-clipboard-list fa-3x"></i>
        </div>
        <h3>No hay hábitos registrados</h3>
        <p>Comienza creando tu primer hábito para mejorar tu rutina diaria.</p>
        <a href="{{ url_for('create_habit') }}" class="btn btn-primary">
            <i class="fas fa-plus"></i> Crear mi primer hábito
        </a>
    </div>
{% endif %}
{% endblock %}